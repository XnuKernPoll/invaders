package world
import "fmt"
func (Srv *Server) Handler() {
	
	if Srv.World.aliens.Len() == 0 {return}
	for {

		select { 

		case msg := <-Srv.ch:
		  go Srv.Move(msg.id)
			

		case <- Srv.sig:
			fmt.Println("Server exiting")
			return
		}
		//numAliens :=
	}
	
}

	

	



func MakeServer(worldMap *WorldMap) *Server {
	return &Server{worldMap, make(chan TMSG), make(chan bool)}
}   




func (Alien *Alien) Worker(conn chan TMSG) {

	
	for { 
		req := TMSG{id: Alien.id}
		conn <- req

		rep := <- Alien.ch
		switch rep.status {

		case map_change:
			req1 := TMSG{id: Alien.id}
			conn <- req1

		case disconnect:
			fmt.Printf("Alien %d exiting\n", Alien.id)
			return

		default:
			return

		}

		
	}

}  

func (Srv *Server) SpawnWorkers() {
	m1 := Srv.World.aliens.Copy()
	
	for _, a := range m1 {
		a1 := a
		go a1.Worker(Srv.ch) 
	}

}  
